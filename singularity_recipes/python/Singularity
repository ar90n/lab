Bootstrap: localimage

From: ../images/dev_env.simg


%runscript

    exec /opt/miniconda3/bin/python

%files
   
    python_dein.toml /opt/nvim/specs
    pipenv /opt/bin
    jupyter-server /opt/bin

%environment

    PATH=/opt/bin:/opt/miniconda3/bin:$PATH
    export PATH

%labels

%post

    export XDG_CONFIG_HOME=/opt/
    export XDG_DATA_HOME=/opt/

    curl -o /tmp/miniconda.sh https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
    bash /tmp/miniconda.sh -b -p /opt/miniconda3
    rm  /tmp/miniconda.sh

    /opt/miniconda3/bin/conda install -y tensorflow
    /opt/miniconda3/bin/conda install -y -c pytorch pytorch
    /opt/miniconda3/bin/conda install -y -c conda-forge xgboost lightgbm
    /opt/miniconda3/bin/conda install -y jupyter
    /opt/miniconda3/bin/conda install -y -c conda-forge jupyter_contrib_nbextensions jupyter_nbextensions_configurator ipywidgets
    /opt/miniconda3/bin/conda install -y -c damianavila82 rise
    /opt/miniconda3/bin/conda install -y -c r libiconv
    /opt/miniconda3/bin/conda install -y -c conda-forge gdcm pydicom nibabel
    /opt/miniconda3/bin/conda install -y -c simpleitk simpleitk
    /opt/miniconda3/bin/conda install -y -c conda-forge numpy scipy scikit-learn scikit-image matplotlib seaborn bokeh holoviews pillow networkx
    /opt/miniconda3/bin/conda install -y -c conda-forge pandas pandas-datareader
    /opt/miniconda3/bin/conda install -y -c conda-forge coconut flexx pudb asciimatics mypy monkeytype
    /opt/miniconda3/bin/conda install -y -c conda-forge flask tinydb scrapy requests hy click
    /opt/miniconda3/bin/conda install -y -c conda-forge black jedi pytest pytest-xdist python-language-server
    /opt/miniconda3/bin/conda install -y -c conda-forge dash dash-renderer dash-html-components dash-core-components plotly
    /opt/miniconda3/bin/conda install -y cython
    /opt/miniconda3/bin/conda clean -t
    /opt/miniconda3/bin/pip install pipenv

    mkdir -p /opt/jupyter/nbextensions
    /opt/miniconda3/bin/jupyter notebook --generate-config
    git clone https://github.com/lambdalisue/jupyter-vim-binding.git /opt/jupyter/nbextensions/vim_binding
    /opt/miniconda3/bin/jupyter contrib nbextension install --user
    /opt/miniconda3/bin/jupyter nbextensions_configurator enable --user
    /opt/miniconda3/bin/jupyter-nbextension enable vim_binding/vim_binding
    /opt/miniconda3/bin/jupyter-nbextension enable --py widgetsnbextension --user
    /opt/miniconda3/bin/jupyter-nbextension install rise --py --user
    /opt/miniconda3/bin/jupyter-nbextension enable rise --py --user
    chmod -R 777 /opt/jupyter

    nvim -c 'call dein#install()' -c 'q'
    nvim -c 'UpdateRemotePlugins' -c 'q'
    chmod -R 777 /opt/nvim/shada
